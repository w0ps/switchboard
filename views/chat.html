<template name="chat">
  <section class="chat">
    <div>
      {{#each conversation}}
        <div class="speakingturn{{whose}}">
          <span class="name">{{userIdToUserName createdBy}}</span>
          {{> avatar}}
        </div>
        {{#each streaks}}
          <div class="streak{{whose}}">
            {{#each lines}}
              <span class="chatline{{whose}}">
                {{text}}
              </span>
            {{/each}}
          </div>
          <p class="chat-timecode{{whose}}">{{formatTime created}}</p>
        {{/each}}
      {{/each}}
      {{#each need.writingMessage}}
        <div class="streak">
          <chatline>{{userIdToUserName this}} is typing...</chatline>
        </div>
      {{/each}}
    </div>
  </section>
  <footer id="need-detail-footer">
    {{#if isAllowed 'post chatmessages'}}
      <input style="width: calc( 100% - 25px * {{need.inChat.length}} )" class="inverted" name="message" placeholder="..." autocomplete="off" />
    {{/if}}
    {{#with need}}
      {{#each inChat}}
        {{{getAvatar this}}}
      {{/each}}
      {{#each responses}}
        {{> response}}
      {{/each}}
    {{/with}}
  </footer>
</template>
