<template name="needs">
  {{#if isAllowed 'separate windows'}}
    {{> needlist}}
  {{else}}
    <aside id="needlist">{{> needlist}}</aside>
    <section id="openchats">{{> chatcollection}}</section>
  {{/if}}
</template>

<template name="needlist">
  {{#if isAllowed 'post needs'}}
    <input class="inverted" name="need" placeholder="what is your need" />
  {{/if}}
  <ul class="needs">
    {{#each needs}}
      {{> need}}
    {{/each}}
  </ul>
</template>

<template name="need">
  <li class="need">
    {{#if isAllowed 'post supplies'}}
      <button class="supply">S</button>
    {{/if}}
    {{{getAvatar createdBy}}}
    <span class="name">{{userIdToUserName createdBy}}</span>
    <span class="timecode">{{formatTime created}}</span>
    <span {{contenteditability}}>{{title}}</span>
    {{#each getSupplies _id}}
      {{> supply this}}
    {{/each}}
  </li>
</template>

<template name="supply">
  <p>{{{getAvatar createdBy}}}{{value}}</p>
</template>

<template name="chatcollection">
  <div style="width: calc( {{conversations.length}} * 300px ); height: 100%; position: relative">
    {{#each conversations}}
      <div class="conversation">
        <button class="close">x</button>
        {{> chat this}}
      </div>
    {{/each}}
  </div>
</template>